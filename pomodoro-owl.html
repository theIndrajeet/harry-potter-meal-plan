<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magical Owl Pomodoro Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --parchment: #f5eeda;
            --dark-brown: #3a2d21;
            --maroon: #740001;
            --gold: #eeba30;
            --light-brown: #c8bfa8;
            --owl-body-original: #8B4513; /* SaddleBrown */
            --owl-beak-feet-original: #FFD700; /* Gold */
            --owl-eyes-original: #FFFFFF;
            --owl-pupils-original: #000000;
            --owl-wing-highlight-original: #A0522D; /* Sienna */
        }

        body {
            font-family: 'Merriweather', serif;
            background-color: var(--parchment);
            color: var(--dark-brown);
            background-image: url('data:image/svg+xml,%3Csvg width="52" height="26" viewBox="0 0 52 26" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23d2c4a8" fill-opacity="0.2"%3E%3Cpath d="M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-3.314 0-6-2.686-6-6 0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6zm25.464-1.95l8.486 8.486-1.414 1.414-8.486-8.486 1.414-1.414z" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            background-color: rgba(255, 253, 248, 0.85); /* Light Parchment */
            padding: 2rem;
            border-radius: 10px;
            border: 2px solid var(--light-brown);
            box-shadow: 0 8px 16px rgba(58, 45, 33, 0.3);
            max-width: 500px; /* Adjusted for a more compact Pomodoro timer */
            width: 100%;
        }

        .header-title {
            font-family: 'Cinzel Decorative', cursive;
            color: var(--maroon);
            text-align: center;
            font-size: 2.2rem; /* Slightly smaller for this context */
            margin-bottom: 1.5rem;
            text-shadow: 1px 1px var(--gold);
        }

        /* Pixel Owl Styles */
        .pixel-owl-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
        }
        .pixel-owl {
            width: 80px; /* Base size, 8x10 grid of 10px pixels */
            height: 100px;
            display: grid;
            grid-template-columns: repeat(8, 10px);
            grid-template-rows: repeat(10, 10px);
            position: relative;
            transition: transform 0.3s ease;
        }
         .pixel-owl:hover {
            transform: scale(1.05); /* Slight grow on hover */
        }

        .pixel {
            background-color: transparent; /* Default */
        }
        .owl-body-pixel { background-color: var(--owl-body-original); }
        .owl-beak-pixel { background-color: var(--owl-beak-feet-original); }
        .owl-eye-pixel { background-color: var(--owl-eyes-original); }
        .owl-pupil-pixel { background-color: var(--owl-pupils-original); }
        .owl-wing-pixel { background-color: var(--owl-wing-highlight-original); }
        .owl-feet-pixel { background-color: var(--owl-beak-feet-original); }

        /* Owl Blinking Animation */
        .eye-left, .eye-right { /* These classes were in your HTML but not styled, added for completeness if needed */
            position: relative;
        }
        .eyelid {
            position: absolute;
            width: 100%;
            height: 0%; /* Start closed for blink */
            background-color: var(--owl-body-original);
            animation: blink 4s infinite ease-in-out 1s; /* Delay first blink */
            bottom: 0; /* For blinking from top-down */
        }
        @keyframes blink {
            0%, 90%, 100% { height: 0%; } /* Eye open */
            92%, 98% { height: 100%; } /* Eye closed */
        }


        .owl-status {
            text-align: center;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--maroon); /* Changed from --dark-maroon as it wasn't defined */
        }
        .owl-status .energy-bar-container {
            width: 100px;
            height: 15px;
            background-color: var(--light-brown);
            border: 1px solid var(--dark-brown);
            border-radius: 5px;
            margin: 0.5rem auto;
            overflow: hidden;
        }
        .owl-status .energy-bar {
            height: 100%;
            width: 100%; /* Full initially */
            background-color: var(--gold);
            transition: width 0.5s ease-in-out;
        }


        /* Pomodoro Timer Styles */
        .timer-display {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 3.5rem;
            color: var(--maroon);
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 1px 1px var(--gold);
        }
        .timer-controls button, .pet-controls button {
            font-family: 'Cinzel Decorative', cursive;
            background-color: var(--gold);
            color: var(--maroon);
            border: 2px solid var(--maroon);
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(58, 45, 33, 0.3);
            margin: 0.3rem;
            font-size: 0.9rem;
        }
        .timer-controls button:hover, .pet-controls button:hover {
            background-color: var(--maroon);
            color: var(--gold);
            box-shadow: 0 4px 8px rgba(58, 45, 33, 0.5);
        }
        .timer-controls button:disabled, .pet-controls button:disabled {
            background-color: var(--light-brown);
            color: #888;
            border-color: #888;
            cursor: not-allowed;
        }
        .timer-status, .treat-count { /* Combined timer-status and treat-count as they had identical styling */
            text-align: center;
            font-size: 1rem;
            margin-top: 0.5rem;
            color: var(--dark-brown);
        }
        .pet-controls {
            margin-top: 1.5rem;
            text-align: center;
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--maroon);
            color: var(--gold);
            padding: 1rem 1.5rem;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, top 0.5s ease-in-out;
            font-family: 'Cinzel Decorative', cursive;
        }
        .message-box.show {
            opacity: 1;
            top: 40px;
        }
         /* Back Button */
        .back-button-container { text-align: left; margin-bottom: 1rem; }
        .back-button {
            display: inline-block; font-family: 'Cinzel Decorative', cursive;
            background-color: rgba(192, 192, 192, 0.7); color: var(--dark-brown);
            border: 1px solid var(--maroon); padding: 6px 12px; border-radius: 5px;
            cursor: pointer; transition: all 0.3s; text-decoration: none;
        }
        .back-button:hover { background-color: var(--maroon); color: var(--gold); box-shadow: 0 2px 5px rgba(58, 45, 33, 0.4); }

    </style>
</head>
<body>
    <div class="container">
        <div class="back-button-container">
             <a href="index.html" class="back-button">‚Üê To Shared Universe</a>
        </div>
        <h1 class="header-title">Magical Owl Pomodoro</h1>

        <div class="pixel-owl-container">
            <div class="pixel-owl" id="pixelOwl">
                <div class="pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel"></div><div class="pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel"></div>
                <div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div>
                <div class="pixel owl-body-pixel"></div><div class="pixel owl-eye-pixel eye-left"><div class="eyelid"></div></div><div class="pixel owl-pupil-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-eye-pixel eye-right"><div class="eyelid"></div></div><div class="pixel owl-pupil-pixel"></div><div class="pixel owl-body-pixel"></div>
                <div class="pixel owl-body-pixel"></div><div class="pixel owl-pupil-pixel"></div><div class="pixel owl-eye-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-pupil-pixel"></div><div class="pixel owl-eye-pixel"></div><div class="pixel owl-body-pixel"></div>
                <div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-beak-pixel"></div><div class="pixel owl-beak-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div>
                <div class="pixel owl-body-pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel owl-body-pixel"></div>
                <div class="pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel"></div>
                <div class="pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-body-pixel"></div><div class="pixel owl-wing-pixel"></div><div class="pixel"></div>
                <div class="pixel"></div><div class="pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel"></div><div class="pixel"></div>
                <div class="pixel"></div><div class="pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel"></div><div class="pixel"></div><div class="pixel owl-feet-pixel"></div><div class="pixel"></div><div class="pixel"></div>
            </div>
        </div>
        <div class="owl-status">
            <p id="owlStatusText">Hedwig is feeling energetic!</p>
            <div class="energy-bar-container">
                <div id="owlEnergyBar" class="energy-bar"></div>
            </div>
        </div>

        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="timer-status" id="timerStatus">Ready to focus?</div>
        <div class="timer-controls text-center">
            <button id="startButton">Start Work</button>
            <button id="pauseButton" disabled>Pause</button>
            <button id="resetButton">Reset</button>
        </div>

        <div class="pet-controls">
            <p class="treat-count">Owl Treats ü¶â: <span id="treatCount">0</span></p>
            <button id="feedOwlButton" disabled>Feed Hedwig (1 Treat)</button>
        </div>
    </div>

    <div id="messageBox" class="message-box"></div>

    <script>
        // Pomodoro Timer Variables
        let WORK_TIME = 25 * 60; // 25 minutes in seconds
        let SHORT_BREAK_TIME = 5 * 60; // 5 minutes in seconds
        let LONG_BREAK_TIME = 15 * 60; // 15 minutes in seconds
        let timerInterval; // To store the interval ID
        let currentTime = WORK_TIME; // Current time left in seconds
        let isPaused = true; // Timer starts paused
        let currentMode = 'work'; // Can be 'work', 'shortBreak', or 'longBreak'
        let workSessionsCompleted = 0; // Counter for work sessions to trigger long breaks

        // DOM Elements
        const timerDisplay = document.getElementById('timerDisplay');
        const timerStatus = document.getElementById('timerStatus');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const resetButton = document.getElementById('resetButton');

        // Owl Pet Variables
        let owlEnergy = 100; // Max 100
        let treatCount = 0;
        const owlStatusText = document.getElementById('owlStatusText');
        const owlEnergyBar = document.getElementById('owlEnergyBar');
        const feedOwlButton = document.getElementById('feedOwlButton');
        const treatCountDisplay = document.getElementById('treatCount');
        const pixelOwlElement = document.getElementById('pixelOwl'); // The main owl element
        const messageBox = document.getElementById('messageBox');

        // Tone.js Synths (will be initialized on first user interaction to enable audio context)
        let workEndSynth, breakEndSynth, feedSynth;
        let soundsMuted = false; // Variable to control sound muting

        // --- Sound Initialization ---
        // This function initializes the synthesizers for sound effects.
        // It's called once, typically after the first user interaction that should produce sound.
        function initializeSounds() {
            if (workEndSynth) return; // Avoid re-initializing if already done

            // Synthesizer for when a work session ends
            workEndSynth = new Tone.Synth({
                oscillator: { type: "triangle" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5 }
            }).toDestination();
            // Add a reverb effect to the work end sound for a fuller feel
            const workReverb = new Tone.Reverb(1).toDestination(); // 1 second reverb time
            workEndSynth.connect(workReverb);

            // Synthesizer for when a break session ends
            breakEndSynth = new Tone.Synth({
                oscillator: { type: "sine" }, // Sine wave for a softer tone
                envelope: { attack: 0.02, decay: 0.3, sustain: 0.2, release: 0.6 }
            }).toDestination();
            const breakReverb = new Tone.Reverb(1.5).toDestination(); // Slightly longer reverb for breaks
            breakEndSynth.connect(breakReverb);

            // Synthesizer for the owl feeding sound
            feedSynth = new Tone.PluckSynth({ // PluckSynth for a "plucky" or "twangy" sound
                attackNoise: 0.5,    // Amount of noise in the attack
                dampening: 3000,     // How quickly the sound fades (higher is faster)
                resonance: 0.7       // Resonance of the sound
            }).toDestination();
            const feedReverb = new Tone.Reverb(0.5).toDestination(); // Shorter reverb for feed sound
            feedSynth.connect(feedReverb);
        }

        // --- Play Sound Utility ---
        // A helper function to play a sound from a given synth.
        // Checks if sounds are muted and if the audio context is running.
        function playSound(synth, note, duration) {
            if (!soundsMuted && synth && Tone.context.state === 'running') {
                synth.triggerAttackRelease(note, duration, Tone.now()); // Play the note for the given duration
            }
        }

        // --- Utility Functions ---
        // Formats seconds into a MM:SS string.
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            // Pad with leading zeros if needed
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Displays a message in the message box for a set duration.
        function showMessage(message, duration = 3000) {
            messageBox.textContent = message;
            messageBox.classList.add('show'); // CSS class to make it visible
            // Hide the message box after the specified duration
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, duration);
        }

        // --- Owl Functions ---
        // Updates the owl's status text, energy bar, and visual transformations.
        function updateOwlStatus() {
            owlEnergyBar.style.width = owlEnergy + '%'; // Set energy bar width
            // Change owl's appearance and status message based on energy level
            if (owlEnergy > 70) {
                owlStatusText.textContent = "Hedwig is hooting happily!";
                pixelOwlElement.style.transform = 'scale(1)'; // Normal size
            } else if (owlEnergy > 30) {
                owlStatusText.textContent = "Hedwig looks a bit peckish.";
                pixelOwlElement.style.transform = 'scale(0.95)'; // Slightly smaller
            } else if (owlEnergy > 0) {
                owlStatusText.textContent = "Hedwig seems tired and hungry...";
                pixelOwlElement.style.transform = 'scale(0.9) rotate(-3deg)'; // Smaller and tilted
            } else { // Owl energy is 0
                owlStatusText.textContent = "Oh no! Hedwig has flown off to find food!";
                pixelOwlElement.style.transform = 'scale(0.8) rotate(-10deg) translateY(10px)'; // Even smaller, tilted, and moved
            }
            // Enable/disable feed button based on treat count and owl energy
            feedOwlButton.disabled = treatCount === 0 || owlEnergy >= 100;
        }

        // Handles feeding the owl.
        function feedOwl() {
            if (treatCount > 0 && owlEnergy < 100) { // Can only feed if has treats and owl not full energy
                treatCount--;
                owlEnergy = Math.min(100, owlEnergy + 25); // Increase energy by 25, max 100
                treatCountDisplay.textContent = treatCount; // Update treat display
                updateOwlStatus(); // Update owl's visual status
                playSound(feedSynth, "C5", "8n"); // Play feeding sound
                showMessage("Hedwig enjoyed the treat!", 2000); // Show confirmation message
            }
        }

        // Decreases owl's energy during work sessions.
        function decreaseOwlEnergy() {
            // Energy only decreases during 'work' mode, if timer is running, and owl has energy
            if (currentMode === 'work' && !isPaused && owlEnergy > 0) {
                owlEnergy = Math.max(0, owlEnergy - 0.5); // Decrease energy, minimum 0
                updateOwlStatus(); // Update owl's visual status
            }
        }

        // --- Timer Functions ---
        // Updates the timer display on the page.
        function updateDisplay() {
            timerDisplay.textContent = formatTime(currentTime);
        }

        // Starts or resumes the timer.
        function startTimer() {
            if (isPaused) { // Only start if paused
                isPaused = false;
                // Update button states
                startButton.disabled = true;
                pauseButton.disabled = false;
                // Set status message based on current mode
                timerStatus.textContent = currentMode === 'work' ? "Focus Time!" : (currentMode === 'shortBreak' ? "Short Break!" : "Long Break!");

                // Set up the interval to decrease time every second
                timerInterval = setInterval(() => {
                    currentTime--;
                    updateDisplay();
                    decreaseOwlEnergy(); // Owl energy decreases during work

                    // When timer reaches zero
                    if (currentTime < 0) {
                        clearInterval(timerInterval); // Stop the interval
                        handleSessionEnd(); // Handle the end of the session
                    }
                }, 1000); // 1000 milliseconds = 1 second
            }
        }

        // Pauses the timer.
        function pauseTimer() {
            isPaused = true;
            clearInterval(timerInterval); // Stop the interval
            // Update button states
            startButton.disabled = false;
            startButton.textContent = "Resume"; // Change start button text to "Resume"
            pauseButton.disabled = true;
        }

        // Resets the timer to the specified mode (default is 'work').
        function resetTimer(mode = 'work') {
            clearInterval(timerInterval); // Stop any active interval
            isPaused = true;
            currentMode = mode;

            // Set current time and status message based on the mode
            switch (mode) {
                case 'work':
                    currentTime = WORK_TIME;
                    timerStatus.textContent = "Ready to focus?";
                    break;
                case 'shortBreak':
                    currentTime = SHORT_BREAK_TIME;
                    timerStatus.textContent = "Time for a short break!";
                    break;
                case 'longBreak':
                    currentTime = LONG_BREAK_TIME;
                    timerStatus.textContent = "Time for a long break!";
                    break;
            }
            updateDisplay(); // Update timer display
            // Reset button states
            startButton.disabled = false;
            startButton.textContent = "Start Work"; // Reset start button text
            pauseButton.disabled = true;
            updateOwlStatus(); // Update owl status as energy might be reset or mode changed
        }

        // Handles the logic when a Pomodoro session (work or break) ends.
        function handleSessionEnd() {
            if (currentMode === 'work') {
                workSessionsCompleted++;
                treatCount++; // Award a treat for completing a work session
                treatCountDisplay.textContent = treatCount;
                feedOwlButton.disabled = treatCount === 0 || owlEnergy >= 100; // Update feed button state
                showMessage("Pomodoro complete! You earned an owl treat! ü¶â", 3000);
                playSound(workEndSynth, "G4", "4n"); // Play work session end sound

                // After 4 work sessions, start a long break, otherwise a short break
                if (workSessionsCompleted % 4 === 0) {
                    resetTimer('longBreak');
                } else {
                    resetTimer('shortBreak');
                }
            } else { // Break ended
                showMessage(currentMode === 'shortBreak' ? "Break's over! Back to work." : "Long break finished! Ready for more?", 3000);
                playSound(breakEndSynth, "C4", "4n"); // Play break session end sound
                resetTimer('work'); // Switch back to work mode
            }
            // Update start button text for the new mode
            startButton.textContent = currentMode === 'work' ? "Start Work" : "Start Break";
        }

        // --- Event Listeners ---
        // Event listener for the start button
        startButton.addEventListener('click', async () => {
            await Tone.start(); // Ensure Tone.js audio context is started by user gesture
            initializeSounds(); // Initialize sounds if not already done
            startTimer();
        });
        // Event listener for the pause button
        pauseButton.addEventListener('click', pauseTimer);
        // Event listener for the reset button (resets to work mode)
        resetButton.addEventListener('click', () => resetTimer('work'));
        // Event listener for the feed owl button
        feedOwlButton.addEventListener('click', feedOwl);

        // --- Initial Setup ---
        // Set the initial timer display and owl status when the page loads
        updateDisplay();
        updateOwlStatus();
    </script>
</body>
</html>
